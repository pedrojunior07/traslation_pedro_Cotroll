<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tradutor Master - API Tester</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .config-section {
            background: white;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 25px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }

        .section {
            background: white;
            padding: 25px;
            margin-bottom: 25px;
            border-radius: 12px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }

        h2 {
            color: #667eea;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
            font-size: 1.5em;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
        }

        input[type="text"],
        input[type="number"],
        select,
        textarea {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 14px;
            font-family: monospace;
            transition: border-color 0.3s;
        }

        input[type="text"]:focus,
        input[type="number"]:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            min-height: 150px;
            resize: vertical;
        }

        button {
            padding: 12px 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        .result {
            background: #f8f9fa;
            padding: 15px;
            margin-top: 15px;
            border-radius: 6px;
            border-left: 4px solid #667eea;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            word-break: break-all;
            max-height: 400px;
            overflow-y: auto;
        }

        .result:empty {
            display: none;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 15px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
        }

        .status-success {
            background: #d4edda;
            color: #155724;
        }

        .status-error {
            background: #f8d7da;
            color: #721c24;
        }

        .provider-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .provider-card {
            flex: 1;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .provider-card:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .provider-card.active {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ Tradutor Master - API Tester</h1>

        <!-- Configura√ß√£o -->
        <div class="config-section">
            <h2>‚öôÔ∏è Configura√ß√£o</h2>
            <div class="grid">
                <div class="form-group">
                    <label>Base URL da API:</label>
                    <input type="text" id="baseUrl" value="http://localhost:8000">
                </div>
                <div class="form-group">
                    <label>Device Token:</label>
                    <input type="text" id="token" placeholder="Cole seu device token aqui">
                </div>
            </div>
            <button onclick="testConnection()">üîå Testar Conex√£o</button>
            <div class="result" id="connectionResult"></div>
        </div>

        <!-- Configura√ß√£o de IA (Admin) -->
        <div class="section">
            <h2>ü§ñ Configura√ß√£o de IA (Admin)</h2>

            <div class="form-group">
                <label>Provedor de IA:</label>
                <div class="provider-selector">
                    <div class="provider-card" onclick="selectProvider('openai')">
                        <strong>OpenAI</strong>
                        <p style="font-size: 12px; margin-top: 5px;">GPT-4, GPT-3.5</p>
                    </div>
                    <div class="provider-card" onclick="selectProvider('gemini')">
                        <strong>Gemini</strong>
                        <p style="font-size: 12px; margin-top: 5px;">Gemini 1.5</p>
                    </div>
                    <div class="provider-card" onclick="selectProvider('grok')">
                        <strong>Grok</strong>
                        <p style="font-size: 12px; margin-top: 5px;">Grok 2</p>
                    </div>
                </div>
            </div>

            <div id="openaiConfig" style="display: none;">
                <h3>OpenAI Configuration</h3>
                <input type="text" id="openaiApiKey" placeholder="OpenAI API Key">
                <input type="text" id="openaiModel" placeholder="Model (ex: gpt-4o-mini)" value="gpt-4o-mini">
                <input type="text" id="openaiBaseUrl" placeholder="Base URL" value="https://api.openai.com/v1">
            </div>

            <div id="geminiConfig" style="display: none;">
                <h3>Gemini Configuration</h3>
                <input type="text" id="geminiApiKey" placeholder="Gemini API Key">
                <input type="text" id="geminiModel" placeholder="Model (ex: gemini-1.5-flash)" value="gemini-1.5-flash">
            </div>

            <div id="grokConfig" style="display: none;">
                <h3>Grok Configuration</h3>
                <input type="text" id="grokApiKey" placeholder="Grok API Key">
                <input type="text" id="grokModel" placeholder="Model (ex: grok-2-latest)" value="grok-2-latest">
            </div>

            <div class="form-group">
                <label>Timeout (segundos):</label>
                <input type="number" id="timeout" value="30" min="5" max="120">
            </div>

            <div class="form-group">
                <label>Max Retries:</label>
                <input type="number" id="maxRetries" value="3" min="1" max="10">
            </div>

            <button onclick="saveAIConfig()">üíæ Salvar Configura√ß√£o</button>
            <button onclick="getAIConfig()">üì• Carregar Configura√ß√£o</button>
            <div class="result" id="aiConfigResult"></div>
        </div>

        <!-- Tradu√ß√£o em Lote -->
        <div class="section">
            <h2>üîÑ Tradu√ß√£o em Lote (IA)</h2>
            <textarea id="batchInput" placeholder="JSON com tokens...">{
  "tokens": [
    {"location": "Paragrafo 1", "text": "Hello World"},
    {"location": "Paragrafo 2", "text": "How are you?"},
    {"location": "Paragrafo 3", "text": "This is a test"}
  ],
  "source": "en",
  "target": "pt"
}</textarea>
            <button onclick="testBatchTranslate()">‚ñ∂Ô∏è Traduzir Lote</button>
            <div class="loading" id="batchLoading">
                <div class="spinner"></div>
                <p>Traduzindo...</p>
            </div>
            <div class="result" id="batchResult"></div>
        </div>

        <!-- Tradu√ß√£o Individual (IA) -->
        <div class="section">
            <h2>üìù Tradu√ß√£o Individual (IA)</h2>
            <div class="grid">
                <input type="text" id="aiSource" placeholder="Idioma origem (ex: en)" value="en">
                <input type="text" id="aiTarget" placeholder="Idioma destino (ex: pt)" value="pt">
            </div>
            <textarea id="aiText" placeholder="Texto para traduzir...">Hello, how are you today?</textarea>
            <button onclick="testAITranslate()">‚ñ∂Ô∏è Traduzir com IA</button>
            <div class="result" id="aiTranslateResult"></div>
        </div>

        <!-- Ver Tradu√ß√µes Recentes -->
        <div class="section">
            <h2>üìä Tradu√ß√µes Recentes</h2>
            <div class="form-group">
                <label>Limite:</label>
                <input type="number" id="recentLimit" value="5" min="1" max="50">
            </div>
            <button onclick="getRecentTranslations()">üì• Buscar Tradu√ß√µes</button>
            <div class="result" id="recentResult"></div>
        </div>

        <!-- Estat√≠sticas de Tokens -->
        <div class="section">
            <h2>üìà Estat√≠sticas de Tokens</h2>
            <button onclick="getTokenStatistics()">üìä Ver Estat√≠sticas</button>
            <div class="result" id="statsResult"></div>
        </div>

        <!-- Uso de Quota -->
        <div class="section">
            <h2>üí≥ Uso de Quota</h2>
            <button onclick="getUsage()">üìä Ver Uso Atual</button>
            <div class="result" id="usageResult"></div>
        </div>
    </div>

    <script>
        let currentProvider = 'openai';

        function selectProvider(provider) {
            currentProvider = provider;

            // Atualizar visual dos cards
            document.querySelectorAll('.provider-card').forEach(card => {
                card.classList.remove('active');
            });
            event.target.closest('.provider-card').classList.add('active');

            // Mostrar/esconder configura√ß√µes
            document.getElementById('openaiConfig').style.display = provider === 'openai' ? 'block' : 'none';
            document.getElementById('geminiConfig').style.display = provider === 'gemini' ? 'block' : 'none';
            document.getElementById('grokConfig').style.display = provider === 'grok' ? 'block' : 'none';
        }

        async function testConnection() {
            const baseUrl = document.getElementById('baseUrl').value;
            const token = document.getElementById('token').value;

            try {
                const response = await fetch(`${baseUrl}/usage`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('connectionResult').textContent =
                        '‚úÖ Conex√£o OK!\n' + JSON.stringify(data, null, 2);
                } else {
                    document.getElementById('connectionResult').textContent =
                        '‚ùå Erro: ' + response.status + '\n' + await response.text();
                }
            } catch (error) {
                document.getElementById('connectionResult').textContent =
                    '‚ùå Erro de conex√£o: ' + error.message;
            }
        }

        async function saveAIConfig() {
            const baseUrl = document.getElementById('baseUrl').value;
            const token = document.getElementById('token').value;

            const config = {
                enabled: true,
                provider: currentProvider,
                timeout: parseFloat(document.getElementById('timeout').value),
                max_retries: parseInt(document.getElementById('maxRetries').value)
            };

            // Adicionar configura√ß√µes espec√≠ficas do provedor
            if (currentProvider === 'openai') {
                config.api_key = document.getElementById('openaiApiKey').value;
                config.model = document.getElementById('openaiModel').value;
                config.base_url = document.getElementById('openaiBaseUrl').value;
            } else if (currentProvider === 'gemini') {
                config.gemini_api_key = document.getElementById('geminiApiKey').value;
                config.gemini_model = document.getElementById('geminiModel').value;
            } else if (currentProvider === 'grok') {
                config.grok_api_key = document.getElementById('grokApiKey').value;
                config.grok_model = document.getElementById('grokModel').value;
            }

            try {
                const response = await fetch(`${baseUrl}/settings/ai`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(config)
                });

                const data = await response.json();
                document.getElementById('aiConfigResult').textContent =
                    response.ok
                    ? '‚úÖ Configura√ß√£o salva!\n' + JSON.stringify(data, null, 2)
                    : '‚ùå Erro: ' + JSON.stringify(data, null, 2);
            } catch (error) {
                document.getElementById('aiConfigResult').textContent =
                    '‚ùå Erro: ' + error.message;
            }
        }

        async function getAIConfig() {
            const baseUrl = document.getElementById('baseUrl').value;
            const token = document.getElementById('token').value;

            try {
                const response = await fetch(`${baseUrl}/settings/ai`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                const data = await response.json();

                if (response.ok) {
                    // Preencher campos
                    document.getElementById('timeout').value = data.timeout;
                    document.getElementById('maxRetries').value = data.max_retries;

                    selectProvider(data.provider);

                    if (data.provider === 'openai') {
                        document.getElementById('openaiModel').value = data.model;
                        document.getElementById('openaiBaseUrl').value = data.base_url;
                    } else if (data.provider === 'gemini') {
                        document.getElementById('geminiModel').value = data.gemini_model;
                    } else if (data.provider === 'grok') {
                        document.getElementById('grokModel').value = data.grok_model;
                    }

                    document.getElementById('aiConfigResult').textContent =
                        '‚úÖ Configura√ß√£o carregada!\n' + JSON.stringify(data, null, 2);
                } else {
                    document.getElementById('aiConfigResult').textContent =
                        '‚ùå Erro: ' + JSON.stringify(data, null, 2);
                }
            } catch (error) {
                document.getElementById('aiConfigResult').textContent =
                    '‚ùå Erro: ' + error.message;
            }
        }

        async function testBatchTranslate() {
            const baseUrl = document.getElementById('baseUrl').value;
            const token = document.getElementById('token').value;
            const payload = JSON.parse(document.getElementById('batchInput').value);

            document.getElementById('batchLoading').classList.add('active');
            document.getElementById('batchResult').textContent = '';

            try {
                const response = await fetch(`${baseUrl}/ai/translate-batch`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(payload)
                });

                const data = await response.json();
                document.getElementById('batchResult').textContent =
                    response.ok
                    ? '‚úÖ Tradu√ß√£o completa!\n' + JSON.stringify(data, null, 2)
                    : '‚ùå Erro: ' + JSON.stringify(data, null, 2);
            } catch (error) {
                document.getElementById('batchResult').textContent =
                    '‚ùå Erro: ' + error.message;
            } finally {
                document.getElementById('batchLoading').classList.remove('active');
            }
        }

        async function testAITranslate() {
            const baseUrl = document.getElementById('baseUrl').value;
            const token = document.getElementById('token').value;

            const payload = {
                text: document.getElementById('aiText').value,
                source: document.getElementById('aiSource').value,
                target: document.getElementById('aiTarget').value,
                units: 1
            };

            try {
                const response = await fetch(`${baseUrl}/ai/translate`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(payload)
                });

                const data = await response.json();
                document.getElementById('aiTranslateResult').textContent =
                    response.ok
                    ? '‚úÖ Tradu√ß√£o:\n' + JSON.stringify(data, null, 2)
                    : '‚ùå Erro: ' + JSON.stringify(data, null, 2);
            } catch (error) {
                document.getElementById('aiTranslateResult').textContent =
                    '‚ùå Erro: ' + error.message;
            }
        }

        async function getRecentTranslations() {
            const baseUrl = document.getElementById('baseUrl').value;
            const token = document.getElementById('token').value;
            const limit = document.getElementById('recentLimit').value;

            try {
                const response = await fetch(`${baseUrl}/translations/recent?limit=${limit}`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                const data = await response.json();
                document.getElementById('recentResult').textContent =
                    response.ok
                    ? JSON.stringify(data, null, 2)
                    : '‚ùå Erro: ' + JSON.stringify(data, null, 2);
            } catch (error) {
                document.getElementById('recentResult').textContent =
                    '‚ùå Erro: ' + error.message;
            }
        }

        async function getTokenStatistics() {
            const baseUrl = document.getElementById('baseUrl').value;
            const token = document.getElementById('token').value;

            try {
                const response = await fetch(`${baseUrl}/tokens/statistics`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                const data = await response.json();
                document.getElementById('statsResult').textContent =
                    response.ok
                    ? JSON.stringify(data, null, 2)
                    : '‚ùå Erro: ' + JSON.stringify(data, null, 2);
            } catch (error) {
                document.getElementById('statsResult').textContent =
                    '‚ùå Erro: ' + error.message;
            }
        }

        async function getUsage() {
            const baseUrl = document.getElementById('baseUrl').value;
            const token = document.getElementById('token').value;

            try {
                const response = await fetch(`${baseUrl}/usage`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                const data = await response.json();
                document.getElementById('usageResult').textContent =
                    response.ok
                    ? JSON.stringify(data, null, 2)
                    : '‚ùå Erro: ' + JSON.stringify(data, null, 2);
            } catch (error) {
                document.getElementById('usageResult').textContent =
                    '‚ùå Erro: ' + error.message;
            }
        }

        // Inicializar com OpenAI selecionado
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.provider-card')[0].classList.add('active');
            document.getElementById('openaiConfig').style.display = 'block';
        });
    </script>
</body>
</html>
